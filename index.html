
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>a4</title>
    <meta name="description" content="Assignment 4">
    <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="public/style.css">
    <script src="js/three.js"></script>
    <script src="js/physi.js"></script>
    <script src="js/OrbitControls.js"></script>
  </head>
  <body>
     <script>
      'use strict';
      Physijs.scripts.worker = 'js/physijs_worker.js';
      Physijs.scripts.ammo = 'ammo.js';
      let initScene, render, renderer, scene, camera, box, ground, ground_material, friction, controls;

      initScene = function() {
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.getElementById( 'viewport' ).appendChild( renderer.domElement );

        scene = new Physijs.Scene;
        camera = new THREE.PerspectiveCamera(
          35,
          window.innerWidth / window.innerHeight,
          1,
          1000
        );
        camera.position.set( 300, 100, 60 );
        camera.lookAt( scene.position );
        controls = new THREE.OrbitControls( camera , renderer.domElement);
        scene.add( camera );

        
        ground_material = Physijs.createMaterial(
            new THREE.MeshBasicMaterial( { color: 0x42f595 } ) ,.9, .1), // low restitution
        // Ground
        ground = new Physijs.BoxMesh(new THREE.BoxGeometry(150, 1, 150),ground_material,1 // mass
        );
        ground.receiveShadow = true;
        
        var constraint = new Physijs.PointConstraint(
            ground,
            new THREE.Vector3( 0, 0, 0 ) 
        );

        //scene.add("https://cdn.glitch.com/c3c1ab32-34b4-400c-9040-faa6873ac320%2Ftree.obj?v=1569096411935")

        // Box
         let ball_material = Physijs.createMaterial(
            new THREE.MeshBasicMaterial( { color: 0xff9ce8 } ) ,.9, .1), // low restitution
        // Ground
        box = new Physijs.BoxMesh (
          new THREE.BoxGeometry(5,5,5),
          ball_material, 1);
        box.addEventListener( 'collision', function( objCollidedWith, linearVelOfCollision, angularVelOfCollision ) {
        });
        requestAnimationFrame( render );
        box.position.z = 10;
        box.position.x = 0;
        box.position.y = 50;
        box.rotation.x = 10;
        box.__dirtyPosition = true;
        document.addEventListener("keydown", onDocumentKeyDown, false); 
        //document.addEventListener("keyup", onDocumentKeyUp, false); 
        /*
        function onDocumentKeyDown(event) {
              let keyCode = event.which;
              if (keyCode == 87) {
                  box.applyCentralImpulse(new THREE.Vector3(0,0,-5));
              } else if (keyCode == 83) {
                   box.applyCentralImpulse(new THREE.Vector3(0,0,5));
              } else if (keyCode == 65) {
                   box.applyCentralImpulse(new THREE.Vector3(-5,0,0));
              } else if (keyCode == 68) {
                  box.applyCentralImpulse(new THREE.Vector3(5,0,0));
              }
          
            //e.preventDefault();
           //render();
          }d
          */
         let vel1 = .1
          let vel2 = .1
        function onDocumentKeyDown(event) {
              let keyCode = event.which;
              if (keyCode == 87) {
                   ground.setAngularVelocity(new THREE.Vector3(vel1, 0, 0));
                  vel1+= .01
              } else if (keyCode == 83) {
                    ground.setAngularVelocity(new THREE.Vector3(vel1, 0, 0));
                  vel1-= .01
              } else if (keyCode == 65) {
                   ground.setAngularVelocity(new THREE.Vector3(0, -0, vel2));
                  vel2-= .01
              } else if (keyCode == 68) {
                   ground.setAngularVelocity(new THREE.Vector3(0, 0, vel2));
                  vel2+= .01
              }
        }
          
            //e.preventDefault();
           //render();
        
        function onDocumentKeyUp(event){
           let keyCode = event.which;
           if (keyCode == 87) {
                  ground.setLinearVelocity(new THREE.Vector3(0, 0, 0));
                    ground.setAngularVelocity(new THREE.Vector3(0, 0, 0));
              } else if (keyCode == 83) {
                   ground.setLinearVelocity(new THREE.Vector3(0, 0, 0));
                    ground.setAngularVelocity(new THREE.Vector3(0, 0, 0));
              } else if (keyCode == 65) {
                   ground.setLinearVelocity(new THREE.Vector3(0, 0, 0));
                    ground.setAngularVelocity(new THREE.Vector3(0, 0, 0));
              } else if (keyCode == 68) {
                  ground.setLinearVelocity(new THREE.Vector3(0, 0, 0));
                    ground.setAngularVelocity(new THREE.Vector3(0, 0, 0));
              }
        }
      
        scene.add( ground );
         scene.add( box );
          scene.addConstraint( constraint );
      };
       
      
 
       
      render = function() {
        scene.simulate();
        renderer.render( scene, camera); // render the scen
        requestAnimationFrame( render );
      };
       
       

      window.onload = function(){
        initScene();
        render();

      }
    
    </script>
    	<div id="viewport"></div>
  </body>
</html>
